package com.grepiu.test.application.socket;

import java.io.*;
import java.net.ServerSocket;
import java.net.Socket;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

/**
 *
 * 소켓 서버
 *
 */
public class SocketServer {

  // 연결할 포트를 지정합니다.
  private static final int PORT = 9090;
  // 스레드 풀의 최대 스레드 개수를 지정합니다.
  private static final int THREAD_CNT = 10;
  private static ExecutorService threadPool = Executors.newFixedThreadPool(THREAD_CNT);
  public static void main(String[] args) {

    try {
      // 서버소켓 생성
      ServerSocket serverSocket = new ServerSocket(PORT);

      // 소켓서버가 종료될때까지 무한루프
      while(true){
        // 소켓 접속 요청이 올때까지 대기합니다.
        Socket socket = serverSocket.accept();
        try{
          // 요청이 오면 스레드 풀의 스레드로 소켓을 넣어줍니다.
          // 이후는 스레드 내에서 처리합니다.
          threadPool.execute(new ConnectionWrap(socket));
        }catch(Exception e){
          e.printStackTrace();
        }
      }
    } catch (IOException e) {
      e.printStackTrace();
    }
  }
}

// 소켓 처리용 래퍼 클래스입니다.
class ConnectionWrap implements Runnable{

  private Socket socket = null;

  public ConnectionWrap(Socket socket) {
    this.socket = socket;
  }

  @Override
  public void run() {

    try {
      // 응답을 위해 스트림을 얻어옵니다.
      DataInputStream in = new DataInputStream(socket.getInputStream());
      DataOutputStream out = new DataOutputStream(socket.getOutputStream());

      byte[] bytes = new byte[1024];
      int len = in.read(bytes);
      System.out.println("받은 데이터 : "+new String(bytes, 0, len, "KSC5601"));
      String test = "SAC!@#0003179102026000010639102103                        103065                                                      0000N000014000000|없음|#000001|뮤지컬|#000003|콘서트|#000004|연극|#000006|가족/아동|#000007|오페라|#000009|전시/체험|#000013|국악|#000014|무용|#000024|클래식|#000999|기타|#001000|발레|#001001|교육|#001002|합창|#";
      String test1= "SAC!@#0096739204026000000614102103                        102942                                                      0000N000302000002|000188|1|1열|1|01|Y1|0|#000002|000188|1|1열|2|01|Y1|0|#000002|000188|1|1열|3|01|01|1|#000002|000188|1|1열|4|01|0R|0|#000002|000188|1|1열|5|01|01|1|#000002|000188|1|1열|6|01|01|1|#000002|000188|1|1열|7|01|01|1|#000002|000188|1|1열|8|01|01|1|#000002|000188|1|1열|9|01|01|1|#000002|000188|1|1열|10|01|01|1|#000002|000188|1|1열|11|01|01|1|#000002|000188|1|1열|12|01|01|1|#000002|000188|1|1열|13|01|01|1|#000002|000188|1|1열|14|01|01|1|#000002|000188|1|1열|15|01|01|1|#000002|000188|1|1열|16|01|01|1|#000002|000188|1|1열|17|01|01|1|#000002|000188|1|1열|18|01|0R|0|#000002|000188|1|1열|19|01|0R|0|#000002|000188|1|1열|20|01|01|1|#000002|000188|2|2열|1|01|01|1|#000002|000188|2|2열|2|01|01|1|#000002|000188|2|2열|3|01|01|1|#000002|000188|2|2열|4|01|01|1|#000002|000188|2|2열|5|01|01|1|#000002|000188|2|2열|6|01|01|1|#000002|000188|2|2열|7|01|01|1|#000002|000188|2|2열|8|01|01|1|#000002|000188|2|2열|9|01|01|1|#000002|000188|2|2열|10|01|01|1|#000002|000188|2|2열|11|01|01|1|#000002|000188|2|2열|12|01|01|1|#000002|000188|2|2열|13|01|01|1|#000002|000188|2|2열|14|01|01|1|#000002|000188|2|2열|15|01|01|1|#000002|000188|2|2열|16|01|01|1|#000002|000188|2|2열|17|01|01|1|#000002|000188|2|2열|18|01|01|1|#000002|000188|2|2열|19|01|01|1|#000002|000188|2|2열|20|01|01|1|#000002|000188|3|3열|1|01|01|1|#000002|000188|3|3열|2|01|01|1|#000002|000188|3|3열|3|01|01|1|#000002|000188|3|3열|4|01|01|1|#000002|000188|3|3열|5|01|01|1|#000002|000188|3|3열|6|01|01|1|#000002|000188|3|3열|7|01|01|1|#000002|000188|3|3열|8|01|01|1|#000002|000188|3|3열|9|01|01|1|#000002|000188|3|3열|10|01|01|1|#000002|000188|3|3열|11|01|01|1|#000002|000188|3|3열|12|01|01|1|#000002|000188|3|3열|13|01|01|1|#000002|000188|3|3열|14|01|01|1|#000002|000188|3|3열|15|01|01|1|#000002|000188|3|3열|16|01|01|1|#000002|000188|3|3열|17|01|01|1|#000002|000188|3|3열|18|01|01|1|#000002|000188|3|3열|19|01|01|1|#000002|000188|3|3열|20|01|01|1|#000002|000188|4|4열|1|01|01|1|#000002|000188|4|4열|2|01|01|1|#000002|000188|4|4열|3|01|01|1|#000002|000188|4|4열|4|01|01|1|#000002|000188|4|4열|5|01|01|1|#000002|000188|4|4열|6|01|01|1|#000002|000188|4|4열|7|01|01|1|#000002|000188|4|4열|8|01|01|1|#000002|000188|4|4열|9|01|01|1|#000002|000188|4|4열|10|01|01|1|#000002|000188|4|4열|11|01|01|1|#000002|000188|4|4열|12|01|01|1|#000002|000188|4|4열|13|01|01|1|#000002|000188|4|4열|14|01|01|1|#000002|000188|4|4열|15|01|01|1|#000002|000188|4|4열|16|01|01|1|#000002|000188|4|4열|17|01|01|1|#000002|000188|4|4열|18|01|01|1|#000002|000188|4|4열|19|01|01|1|#000002|000188|4|4열|20|01|01|1|#000002|000188|5|5열|1|01|01|1|#000002|000188|5|5열|2|01|01|1|#000002|000188|5|5열|3|01|01|1|#000002|000188|5|5열|4|01|01|1|#000002|000188|5|5열|5|01|01|1|#000002|000188|5|5열|6|01|01|1|#000002|000188|5|5열|7|01|01|1|#000002|000188|5|5열|8|01|01|1|#000002|000188|5|5열|9|01|01|1|#000002|000188|5|5열|10|01|01|1|#000002|000188|5|5열|11|01|01|1|#000002|000188|5|5열|12|01|01|1|#000002|000188|5|5열|13|01|01|1|#000002|000188|5|5열|14|01|01|1|#000002|000188|5|5열|15|01|01|1|#000002|000188|5|5열|16|01|01|1|#000002|000188|5|5열|17|01|01|1|#000002|000188|5|5열|18|01|01|1|#000002|000188|5|5열|19|01|01|1|#000002|000188|5|5열|20|01|01|1|#000001|000188|6|OP열|1|02|01|1|#000001|000188|6|OP열|2|02|01|1|#000001|000188|6|OP열|3|02|01|1|#000001|000188|6|OP열|4|02|01|1|#000001|000188|6|OP열|5|02|01|1|#000001|000188|6|OP열|6|02|01|1|#000001|000188|6|OP열|7|02|01|1|#000001|000188|6|OP열|8|02|01|1|#000001|000188|6|OP열|9|02|01|1|#000001|000188|6|OP열|10|02|01|1|#000001|000188|6|OP열|11|02|01|1|#000001|000188|6|OP열|12|02|01|1|#000001|000188|6|OP열|13|02|01|1|#000001|000188|6|OP열|14|02|01|1|#000001|000188|6|OP열|15|02|01|1|#000001|000188|7|OP열|16|02|01|1|#000001|000188|7|OP열|17|02|01|1|#000001|000188|7|OP열|18|02|01|1|#000001|000188|7|OP열|19|02|01|1|#000001|000188|7|OP열|20|02|01|1|#000001|000188|7|OP열|21|02|01|1|#000001|000188|7|OP열|22|02|01|1|#000001|000188|7|OP열|23|02|01|1|#000001|000188|7|OP열|24|02|01|1|#000001|000188|7|OP열|25|02|01|1|#000001|000188|7|OP열|26|02|01|1|#000001|000188|7|OP열|27|02|01|1|#000001|000188|7|OP열|28|02|01|1|#000001|000188|7|OP열|29|02|01|1|#000001|000188|7|OP열|30|02|01|1|#000001|000188|8|OP열|31|02|01|1|#000001|000188|8|OP열|32|02|01|1|#000001|000188|8|OP열|33|02|01|1|#000001|000188|8|OP열|34|02|01|1|#000001|000188|8|OP열|35|02|01|1|#000001|000188|8|OP열|36|02|01|1|#000001|000188|8|OP열|37|02|01|1|#000001|000188|8|OP열|38|02|01|1|#000001|000188|8|OP열|39|02|01|1|#000001|000188|8|OP열|40|02|01|1|#000001|000188|8|OP열|41|02|01|1|#000001|000188|8|OP열|42|02|01|1|#000001|000188|8|OP열|43|02|01|1|#000001|000188|8|OP열|44|02|01|1|#000001|000188|8|OP열|45|02|01|1|#000001|000188|9|L열|1|02|01|1|#000001|000188|9|L열|2|02|01|1|#000001|000188|9|L열|3|02|01|1|#000001|000188|9|L열|4|02|01|1|#000001|000188|9|L열|5|02|01|1|#000001|000188|9|L열|6|02|01|1|#000001|000340|1|2열|1|02|Y1|0|#000001|000340|1|2열|2|02|Y1|0|#000001|000340|1|2열|3|02|01|1|#000001|000340|1|2열|4|02|01|1|#000001|000340|1|2열|5|02|01|1|#000001|000340|1|2열|6|02|01|1|#000001|000340|1|2열|7|02|01|1|#000001|000340|1|2열|8|02|01|1|#000001|000340|1|2열|9|02|01|1|#000001|000340|1|2열|10|02|01|1|#000001|000340|1|2열|11|02|01|1|#000001|000340|1|2열|12|02|01|1|#000001|000340|1|2열|13|02|01|1|#000001|000340|1|2열|14|02|01|1|#000001|000340|1|2열|15|02|01|1|#000001|000340|2|3열|1|02|01|1|#000001|000340|2|3열|2|02|01|1|#000001|000340|2|3열|3|02|01|1|#000001|000340|2|3열|4|02|01|1|#000001|000340|2|3열|5|02|01|1|#000001|000340|2|3열|6|02|01|1|#000001|000340|2|3열|7|02|01|1|#000001|000340|2|3열|8|02|01|1|#000001|000340|2|3열|9|02|01|1|#000001|000340|2|3열|10|02|01|1|#000001|000340|2|3열|11|02|01|1|#000001|000340|2|3열|12|02|01|1|#000001|000340|2|3열|13|02|01|1|#000001|000340|2|3열|14|02|01|1|#000001|000340|2|3열|15|02|01|1|#000001|000340|3|4열|1|02|01|1|#000001|000340|3|4열|2|02|01|1|#000001|000340|3|4열|3|02|01|1|#000001|000340|3|4열|4|02|01|1|#000001|000340|3|4열|5|02|01|1|#000001|000340|3|4열|6|02|01|1|#000001|000340|3|4열|7|02|01|1|#000001|000340|3|4열|8|02|01|1|#000001|000340|3|4열|9|02|01|1|#000001|000340|3|4열|10|02|01|1|#000001|000340|3|4열|11|02|01|1|#000001|000340|3|4열|12|02|01|1|#000001|000340|3|4열|13|02|01|1|#000001|000340|3|4열|14|02|01|1|#000001|000340|3|4열|15|02|01|1|#000001|000340|4|5열|1|02|01|1|#000001|000340|4|5열|2|02|01|1|#000001|000340|4|5열|3|02|01|1|#000001|000340|4|5열|4|02|01|1|#000001|000340|4|5열|5|02|01|1|#000001|000340|4|5열|6|02|01|1|#000001|000340|4|5열|7|02|01|1|#000001|000340|4|5열|8|02|01|1|#000001|000340|4|5열|9|02|01|1|#000001|000340|4|5열|10|02|01|1|#000001|000340|4|5열|11|02|01|1|#000001|000340|4|5열|12|02|01|1|#000001|000340|4|5열|13|02|01|1|#000001|000340|4|5열|14|02|01|1|#000001|000340|4|5열|15|02|01|1|#000001|000340|5|6열|1|02|01|1|#000001|000340|5|6열|2|02|01|1|#000001|000340|5|6열|3|02|01|1|#000001|000340|5|6열|4|02|01|1|#000001|000340|5|6열|5|02|01|1|#000001|000340|5|6열|6|02|01|1|#000001|000340|5|6열|7|02|01|1|#000001|000340|5|6열|8|02|01|1|#000001|000340|5|6열|9|02|01|1|#000001|000340|5|6열|10|02|01|1|#000001|000340|5|6열|11|02|01|1|#000001|000340|5|6열|12|02|01|1|#000001|000340|5|6열|13|02|01|1|#000001|000340|5|6열|14|02|01|1|#000001|000340|5|6열|15|02|01|1|#000001|000340|6|7열|1|02|01|1|#000001|000340|6|7열|2|02|01|1|#000001|000340|6|7열|3|02|01|1|#000001|000340|6|7열|4|02|01|1|#000001|000340|6|7열|5|02|01|1|#000001|000340|6|7열|6|02|01|1|#000001|000340|6|7열|7|02|01|1|#000001|000340|6|7열|8|02|01|1|#000001|000340|6|7열|9|02|01|1|#000001|000340|6|7열|10|02|01|1|#000001|000340|6|7열|11|02|01|1|#000001|000340|6|7열|12|02|01|1|#000001|000340|6|7열|13|02|01|1|#000001|000340|6|7열|14|02|01|1|#000001|000340|6|7열|15|02|01|1|#000001|000510|1|1열|1|02|Y9|0|#000001|000510|1|1열|2|02|Y9|0|#000001|000510|2|L열|7|02|01|1|#000001|000510|2|L열|8|02|01|1|#000001|000510|2|L열|9|02|01|1|#000001|000510|2|L열|10|02|01|1|#000001|000510|2|L열|11|02|01|1|#000001|000510|2|L열|12|02|01|1|#000001|000510|3|R열|1|02|01|1|#000001|000510|3|R열|2|02|01|1|#000001|000510|3|R열|3|02|01|1|#000001|000510|3|R열|4|02|01|1|#000001|000510|3|R열|5|02|01|1|#000001|000510|3|R열|6|02|01|1|#000001|000540|1|1열|10|02|Y9|0|#000001|000540|1|1열|11|02|Y9|0|#000001|000570|1|1열|3|02|01|1|#000001|000570|1|1열|4|02|01|1|#000001|000570|1|1열|5|02|01|1|#000001|000570|1|1열|6|02|01|1|#000001|000570|1|1열|7|02|01|1|#000001|000570|1|1열|8|02|01|1|#000001|000570|1|1열|9|02|01|1|#000001|000570|2|R열|7|02|01|1|#000001|000570|2|R열|8|02|01|1|#000001|000570|2|R열|9|02|01|1|#000001|000570|2|R열|10|02|01|1|#000001|000570|2|R열|11|02|01|1|#000001|000570|2|R열|12|02|01|1|#000002|000570|3|L열|1|01|01|1|#000002|000570|3|L열|2|01|01|1|#000002|000570|3|L열|3|01|01|1|#000002|000570|3|L열|4|01|01|1|#000002|000570|3|L열|5|01|01|1|#000002|000570|3|L열|6|01|01|1|#000002|000570|3|L열|7|01|01|1|#000002|000570|4|L열|8|01|01|1|#000002|000570|4|L열|9|01|01|1|#000002|000570|4|L열|10|01|01|1|#000002|000570|4|L열|11|01|01|1|#000002|000570|4|L열|12|01|01|1|#000002|000570|4|L열|13|01|01|1|#000002|000570|4|L열|14|01|01|1|#000002|000570|4|L열|15|01|01|1|#000002|000570|4|L열|16|01|01|1|#000002|000700|1|R열|8|01|01|1|#000002|000700|1|R열|9|01|01|1|#000002|000700|1|R열|10|01|01|1|#000002|000700|1|R열|11|01|01|1|#000002|000700|1|R열|12|01|01|1|#000002|000700|1|R열|13|01|01|1|#000002|000700|1|R열|14|01|01|1|#000002|000700|1|R열|15|01|01|1|#000002|000700|1|R열|16|01|01|1|#000002|000700|2|R열|1|01|01|1|#000002|000700|2|R열|2|01|01|1|#000002|000700|2|R열|3|01|01|1|#000002|000700|2|R열|4|01|01|1|#000002|000700|2|R열|5|01|01|1|#000002|000700|2|R열|6|01|01|1|#000002|000700|2|R열|7|01|01|1|#";
      out.write(test1.getBytes("KSC5601"));
      out.flush();
      // 클라이언트로부터 메시지 입력받음
    } catch (IOException e) {
      e.printStackTrace();
    } finally {
      try {
        socket.close(); // 반드시 종료합니다.
      } catch (IOException e) {
        e.printStackTrace();
      }
    }
  }
}
